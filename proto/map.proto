syntax = "proto3";

package map;

service MapGrpcService {
    rpc GetMapList(ReadMapListRequest) returns (ReadMapListResponse);
    rpc GetCurrentMap(Empty) returns (GetCurrentMapResponse);
    rpc GetCloud(GetCloudRequest) returns (GetCloudResponse);
    rpc SaveCloud(SaveCloudRequest) returns (SaveCloudResponse);
    rpc GetTopology(GetTopologyRequest) returns (GetTopologyResponse);
    rpc SaveTopology(SaveTopologyRequest) returns (SaveTopologyResponse);
    rpc Load(LoadRequest) returns (LoadResponse);
    rpc Mapping(MappingRequest) returns (MappingResponse);
    rpc UploadMap(UploadMapRequest) returns (UploadMapResponse);
    rpc DownloadMap(DownloadMapRequest) returns (DownloadMapResponse);
    rpc PublishMap(PublishMapRequest) returns (PublishMapResponse);
    rpc GetMapTileExist(GetMapTileRequest) returns (GetMapTilesExistResponse);
    rpc GetMapTile(GetMapTileRequest) returns (GetMapTileResponse);
    rpc DeleteMap(DeleteMapRequest) returns (DeleteMapResponse);
}

message Empty {}
message Pose {
    double x = 1;
    double y = 2;
    double z = 3;
    double rx = 4;
    double ry = 5;
    double rz = 6;
}

message Link {
    string id = 1;
    optional string info = 2;
    optional double speed = 3;
    optional string method = 4;
    optional int32 safety_field = 5;
}

message Node {
    string id = 1;
    string name = 2;
    Pose pose = 3;
    string info = 4;
    repeated Link links = 5;
    string type = 6;
}

message FileInfo {
  string fileName = 1;
  optional string createAt = 2;
  optional string updateAt = 3;
  optional string fileType = 4;
  optional int32 fileSize = 5;
}
message MapInfo {
  string fileName = 1;
  optional string createAt = 2;
  optional string updateAt = 3;
  optional string fileType = 4;
  repeated FileInfo cloudFiles = 5;
  repeated FileInfo topoFiles = 6;
}

message ReadMapListRequest {
  optional int32 pageNo = 1;
  optional int32 pageSize = 2;
  optional string searchType = 3;
  optional string searchText = 4;
  optional string sortOption = 5;
  optional string sortDirection = 6;
}

message ReadMapListResponse {
  repeated MapInfo list = 1;
  optional int32 pageSize = 2;
  optional int32 totalCount = 3;
  optional int32 totalPage = 4;
}
message GetMapListResponse {
    repeated MapInfo list = 1;
    optional string result = 2;
    optional string message = 3;
}
message GetCurrentMapResponse {
    string mapName = 1;
}

//--Cloud
//string[][]을 위한 편법
message CloudPoint {
    repeated double row = 1;
}
message GetCloudRequest {
    string mapName = 1;
    string fileName = 2;
}
message GetCloudResponse {
    string mapName = 1;
    string fileName = 2;
    repeated CloudPoint cloud = 3;
    optional string result = 4;
    optional string message = 5;
}
message SaveCloudRequest {
    string mapName = 1;
    string fileName = 2;
    repeated CloudPoint cloud = 3;
}
message SaveCloudResponse {
    string mapName = 1;
    string fileName = 2;
    repeated CloudPoint cloud = 3;
    optional string result = 4;
    optional string message = 5;
}
//--Topology
message GetTopologyRequest {
    string mapName = 1;
    string fileName = 2;
    optional string type = 3;
}
message GetTopologyResponse {
    string mapName = 1;
    string fileName = 2;
    optional string type = 3;
    repeated Node data = 4;
    optional string result = 5;
    optional string message = 6;
}
message SaveTopologyRequest {
    string mapName = 1;
    string fileName = 2;
    repeated Node data = 3;
}
message SaveTopologyResponse {
    string mapName = 1;
    string fileName = 2;
    repeated Node data = 3;
    optional string result = 4;
    optional string message = 5;
}
message GetTopologyNewRequest {
    string mapName = 1;
    string fileName = 2;
    optional string type = 3;
}
message LoadRequest {
    string command = 1;
    optional string mapName = 2;
}
message LoadResponse {
    string command = 1;
    optional string mapName = 2;
    string result = 3;
    optional string message = 4;
}

message MappingRequest {
    string command = 1;
    optional string mapName = 2;
}
message MappingResponse {
    string command = 1;
    optional string mapName = 2;
    optional string result = 3;
    optional string message = 4;
}

message UploadMapRequest {
    string mapName = 1;
    optional string newMapName = 2;
}

message UploadMapResponse {
    string mapName = 1;
    string newMapName = 2;
    optional string result = 3;
    optional string message = 4;
}

message DownloadMapRequest {
    string fileName = 1;
    optional string newMapName = 2;
    bool isForce = 3;
}

message DownloadMapResponse {
    string fileName = 1;
    string newMapName = 2;
    bool isForce = 3;
    optional string result = 4;
    optional string message =5;
}

message PublishMapRequest {
    string fileName = 1;
    string newMapName = 2;
    bool isForce = 3;
}

message PublishMapResponse {
    string fileName = 1;
    string newMapName = 2;
    bool isForce = 3;
    optional string result = 4;
    optional string message = 5;
}

message GetMapTilesExistResponse {
    bool exist = 1;
    optional string result = 2;
    optional string message = 3;
}

message GetMapTileRequest {
    string mapName = 1;
    optional double z = 2;
    optional double x = 3;
    optional double y = 4;
}

message GetMapTileResponse {
    bytes data = 1;
}

message DeleteMapRequest {
    string mapName = 1;
}

message DeleteMapResponse {
    string mapName = 1;
}